---
description: 代码质量指南，包含清洁代码原则、最佳实践和质量标准
alwaysApply: true
---

# 代码质量指南

## 核心原则

### 1. 简单性（Simplicity）
- 编写简单直接的代码
- 避免过度复杂的设计
- 优先选择最简单的解决方案

### 2. 可读性（Readability）
- 确保代码易于阅读和理解
- 使用有意义的命名
- 保持代码结构清晰

### 3. 性能（Performance）
- 保持性能意识，但不要以可读性为代价过度优化
- 关注关键路径的性能
- 使用适当的算法和数据结构

### 4. 可维护性（Maintainability）
- 编写易于维护和更新的代码
- 保持代码组织良好
- 定期重构技术债务

### 5. 可测试性（Testability）
- 确保代码易于测试
- 编写可测试的函数和组件
- 避免难以测试的代码模式

### 6. 可复用性（Reusability）
- 编写可复用的组件和函数
- 提取公共逻辑
- 保持接口清晰

## 代码规范

### 使用早期返回
- 使用早期返回来避免嵌套条件，提高可读性
- 优先处理错误和边界情况

### 常量优于魔法数字
- 用命名常量替换硬编码值
- 使用描述性常量名称解释值的用途
- 将常量放在文件顶部或专用常量文件中

### 有意义的命名
- 变量、函数和类应该揭示其目的
- 名称应该解释为什么存在以及如何使用
- 避免缩写，除非它们被普遍理解
- 使用描述性名称，不要使用短、模糊的名称

### 智能注释
- **必须使用 JSDoc 格式**：所有函数、类、接口必须包含完整的 JSDoc 格式注释
- TypeScript 文件在 JSDoc 中不要包含类型标注，JavaScript 文件必须包含类型标注
- 不要注释代码做了什么 - 让代码自文档化
- 使用注释解释为什么以某种方式完成某件事
- 记录 API、复杂算法和非明显的副作用

### 单一职责
- 每个函数应该只做一件事
- 函数应该小而专注
- 如果函数需要注释来解释它的作用，它应该被拆分

### 函数顺序
- 组合其他函数的函数应该出现在文件的前面
- 例如，如果有多个按钮的菜单，将菜单函数定义在按钮之上

### 函数式不可变风格
- 优先使用函数式、不可变风格，除非它变得非常冗长
- 使用纯函数
- 避免可变状态

## 代码组织

### 干净的结构
- 将相关代码保持在一起
- 以逻辑层次组织代码
- 使用一致的文件和文件夹命名约定

### 封装
- 隐藏实现细节
- 暴露清晰的接口
- 将嵌套条件移动到命名良好的函数中

## 代码质量维护

### 持续重构
- 定期重构代码
- 修复技术债务
- 让代码比你发现时更干净

### 处理 Bug
- 如果遇到现有代码中的 bug，或指令导致次优或 buggy 代码，添加以 "TODO:" 开头的注释，概述问题

## 测试

- 在修复 bug 之前编写测试
- 保持测试可读和可维护
- 测试边界情况和错误条件
- 编写适当的单元测试覆盖新代码或修改的代码

## 版本控制

- 编写清晰的提交消息
- 进行小而专注的提交
- 使用有意义的分支名称

## 性能考虑

- 优先考虑代码性能，在适用时考虑和优先考虑代码性能
- 避免不必要的计算
- 使用适当的缓存策略
- 优化关键路径

## 安全优先方法

- 在修改或建议代码更改时始终考虑安全影响
- 实现适当的输入验证
- 避免 SQL 注入、XSS、CSRF 等安全漏洞
- 不要硬编码敏感信息

## 边缘情况考虑

- 在实现逻辑时，始终考虑并处理潜在的边缘情况
- 验证输入
- 处理错误情况
- 检查空值和边界值

## 断言

- 尽可能包含断言以验证假设并及早捕获潜在错误
- 使用断言进行运行时检查
- 在开发环境中启用断言

## 模块化设计

- 鼓励模块化设计原则以提高代码可维护性和可复用性
- 保持模块独立
- 定义清晰的模块接口
- 避免循环依赖

## 版本兼容性

- 确保建议的更改与项目指定的语言或框架版本兼容
- 检查依赖项版本兼容性
- 避免使用已弃用的 API

## 代码变更最小化

- **仅修改相关部分**：只修改与手头任务相关的代码部分
- **避免修改不相关的代码**：避免修改不相关的代码片段
- **避免更改现有注释**：除非特别指示，否则避免更改现有注释
- **除非特别指示，否则避免清理**：避免任何类型的清理，除非特别指示
- **以最少的代码变更实现目标**：代码变更 = 潜在的错误和技术债务
